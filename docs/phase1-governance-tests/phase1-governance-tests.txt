# Phase 1 – Governance & Tagging (Evidence)

This document captures the key test runs and outputs for Phase 1.

---

## 1. Resource group creation

Command:

```bash
bash phase1-governance/scripts/01-setup-resource-groups.sh

output:

Resource groups created:
Name             Location       Tags
---------------  -------------  -----------------------------
rg-governance-demo  canadacentral  null
rg-app-dev-canada   canadacentral  {environment: dev, owner: mehrnaz, costCenter: LAB, criticality: low}
rg-deny-test        canadacentral  null
 
__________________________________________________________________
## 2. Append policy assignment at subscription scope

Command:

```bash
bash phase1-governance/scripts/02-create-append-policy.sh

az policy assignment list (subscription scope):

DefinitionVersion    EnforcementMode    Name                              Scope
-------------------  -----------------  --------------------------------  ---------------------------------------------------
1.*.*                Default            enforce-standard-tags-assignment  /subscriptions/<subscription-id>
...
_________________________________________________________________

## 3. Auto-tagging test (append)

Command:

RG_APP="rg-app-dev-canada"
RAND=$RANDOM
ST_NAME="stappendtest${RAND}"

az storage account create \
  --name "$ST_NAME" \
  --resource-group "$RG_APP" \
  --location canadacentral \
  --sku Standard_LRS

az resource show \
  --resource-group "$RG_APP" \
  --name "$ST_NAME" \
  --resource-type "Microsoft.Storage/storageAccounts" \
  --query tags
---------
output:

{
  "environment": "dev",
  "owner": "mehrnaz",
  "costCenter": "LAB",
  "criticality": "low"
}

_________________________________________________________________
## 4. Deny policy assignment at resource group scope

Command:

SUB_ID=$(az account show --query id -o tsv)
RG_DENY="rg-deny-test"

az policy assignment create \
  --name deny-missing-standard-tags-test \
  --policy deny-missing-standard-tags \
  --scope "/subscriptions/$SUB_ID/resourceGroups/$RG_DENY"


az policy assignment list at RG scope:

DefinitionVersion    EnforcementMode    Name                              Scope
-------------------  -----------------  --------------------------------  ---------------------------------------------------
1.*.*                Default            deny-missing-standard-tags-test   /subscriptions/<subscription-id>/resourceGroups/rg-deny-test

__________________________________________________________________
## 5. Deny behavior (missing tags)

After temporarily removing the append assignment:

SUB_ID=$(az account show --query id -o tsv)

az policy assignment delete \
  --name enforce-standard-tags-assignment \
  --scope "/subscriptions/$SUB_ID"

Test: 

RAND=$RANDOM
ST_NAME_DENY="stdenytest${RAND}"

az storage account create \
  --name "$ST_NAME_DENY" \
  --resource-group "rg-deny-test" \
  --location canadacentral \
  --sku Standard_LRS

Expected result: RequestDisallowedByPolicy error, indicating required tags are missing.

_____________________________________________________________________

## 6. Successful deployment with required tags

Command:
RAND=$RANDOM
ST_NAME_DENY_OK="stdenytestok${RAND}"

az storage account create \
  --name "$ST_NAME_DENY_OK" \
  --resource-group "rg-deny-test" \
  --location canadacentral \
  --sku Standard_LRS \
  --tags environment=dev owner="mehrnaz" costCenter=LAB criticality=low

az resource show \
  --resource-group "rg-deny-test" \
  --name "$ST_NAME_DENY_OK" \
  --resource-type "Microsoft.Storage/storageAccounts" \
  --query tags

Expected tags:

{
  "environment": "dev",
  "owner": "mehrnaz",
  "costCenter": "LAB",
  "criticality": "low"
}

___________________________________________________________________________
************These tests validate:*************

Subscription-level auto-tagging using a custom Azure Policy with append effect

Resource group–level hard enforcement using a custom Azure Policy with deny effect

Correct behavior when tags are present vs. missing